// Copyright (c) 2020 Nicholas Corgan
// SPDX-License-Identifier: GPL-3.0-or-later

#include <Pothos/Plugin.hpp>

#include <json.hpp>

#include <aff3ct.hpp>

static std::string getTurboFECInfoJSON()
{
    nlohmann::json topObject;
    auto& fecInfo = topObject["FEC Info"];
    fecInfo["TurboFEC Version"] = "@TURBOFEC_VERSION@";
    fecInfo["AFF3CT Version"] = aff3ct::tools::version();

    return topObject.dump();
}

pothos_static_block(registerTurboFECInfo)
{
    Pothos::PluginRegistry::addCall(
        "/devices/fec/info",
        &getTurboFECInfoJSON);
}
